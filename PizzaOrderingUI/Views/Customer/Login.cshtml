@using Microsoft.AspNetCore.Http
@model Entities.Customer
@{
    ViewData["Title"] = "Login";
}

<head>
    <link rel="stylesheet" href="~/css/ui.css" />
</head>





<body>
    <div class="row">
        <div class="col-md-4 ">
            <h2>Login</h2>
            <div class="form-group">
                <label asp-for="Username" label class="control-label">UserName</label>
                <input id="username" class="form-control" placeholder="Enter User Name" required />
                <span asp-validation-for="Username" class="text-danger"></span>

            </div>

            <div class="form-group">
                <label asp-for="Password" class="control-label">Password</label>
                <input id="password" type="password" class="form-control" placeholder="Enter Passowrd" required>
                <span asp-validation-for="Password" class="text-danger"></span>

            </div>
            <p style="color:red;" id="failedMessage"></p>

            <div class="form-group">
                <input class="btn-hover color-login" id="login" type="submit" value="Login"  />
            
            </div>

            <div class="form-group">
                <div class="col-md-offset-2 col-md-8">
                    <label class="label-danger" id="loginfailed">Wrong username or password</label>
                </div>
            </div>

            <input type="hidden" name="id">

          




        </div>

    </div>

</body>

<script>
    $("#loginfailed").hide();


    $('#login').click(function (e) {
            
         if ($('#username').val() !== "" && $('#password').val() !== "") {
       
             $('#failedMessage').text("");
            var url = "https://pizzaweb.azurewebsites.net/" + $('#username').val() + ',' + $('#password').val();


            $.ajax({
                contentType: 'application/json',
                type: "GET",
                url: url,

                success: function (data, textStatus, jqXHR) {

                    $.get("/Customer/Session/", { id: data.customerId, username: data.username }, function (data) {
                        window.location.href = "http://localhost:54597/Home/Index";

                    });


                },
                error: function (jqXHR, textStatus, errorThrown) {
                    $("#result").val(jqXHR.statusText);
                    $("#loginfailed").show();
                    //display loginfailed message to user
                    $.get("/Customer/LoginFailed", {}, function (data) {


                    });

                }
            });


              }
            else {
                $('#failedMessage').text("Empty username or password");
            }
        });
   
</script>

